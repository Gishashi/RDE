FROM {{{from}}}

# Configure apt
RUN curl -o- -L https://yarnpkg.com/install.sh | bash

COPY .cache/version {{{workDir}}}/

RUN yarn global add rde

RUN groupadd rde && useradd -ms /bin/bash -g rde rde

WORKDIR {{{workDir}}}

COPY .cache/package-cache.json template/.npmrc* template/.yarnrc* app/.npmrc* app/.yarnrc* {{{workDir}}}/

RUN mv package-cache.json package.json

COPY .cache/package-cache.json app/.npmrc* {{{workDir}}}/template/

RUN chown -R rde:rde {{{workDir}}}

{{!cache node-modules}}
USER rde

ENV HOME {{{workDir}}}

RUN yarn
