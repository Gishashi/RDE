FROM {{{from}}}

WORKDIR {{{workDir}}}

# Remove outdated yarn from /opt and install via package
# so it can be easily updated via apt-get upgrade yarn
RUN rm -rf /opt/yarn-* \
&& rm -f /usr/local/bin/yarn \
&& rm -f /usr/local/bin/yarnpkg \
&& apt-get install -y curl apt-transport-https lsb-release \
&& curl -sS https://dl.yarnpkg.com/$(lsb_release -is | tr '[:upper:]' '[:lower:]')/pubkey.gpg | apt-key add - 2>/dev/null \
&& echo "deb https://dl.yarnpkg.com/$(lsb_release -is | tr '[:upper:]' '[:lower:]')/ stable main" | tee /etc/apt/sources.list.d/yarn.list \
&& apt-get update \
&& apt-get -y install --no-install-recommends yarn

RUN yarn global add rde

{{#isApp}}
COPY .cache/package.json {{{workDir}}}/package.json
{{/isApp}}
{{^isApp}}
COPY ./package.json {{{workDir}}}/package.json
{{/isApp}}

{{!cache node-modules}}
RUN yarn

ENV DOCKER_ENV true
